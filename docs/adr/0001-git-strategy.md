# ADR-0001: Git 브랜치/커밋 전략 (v1-v2)

Status: **Accepted**
Date: 2026-02-14
Last updated: 2026-02-16
Scope: everbit mono-repo (server / client / infra)

---

## Context

everbit 레포지토리는 v1 작업이 `main` 브랜치에 누적되어 있다.
v2는 기존 레포를 유지하면서 v1/v2 이력을 모두 관리해야 하며, 향후 v1 핫픽스 가능성도 있다.

본 프로젝트는 **개인 모노레포(server, client, infra 통합)** 구조이며, 릴리즈는 기본적으로 레포 단위로 수행한다.

또한 v2는 “문서 우선(Documentation-first)” 개발을 고정해야 한다.

---

# Decision

---

# 1. 브랜치 전략

| 브랜치    | 용도           | 비고          |
| ------ | ------------ | ----------- |
| `v1`   | v1 안정 버전 유지  | 핫픽스만 허용     |
| `v2`   | v2 개발 브랜치    | 모든 신규 개발    |
| `main` | 운영/배포 기준 브랜치 | Stable Only |

---

## 1.1 기본 규칙

* `main`의 현 상태를 v1 스냅샷으로 간주하고 `v1.0.0` 태그 생성
* `v1` 브랜치 생성 후 v1 유지보수는 `v1`에서만 수행
* v2 개발은 `v2`에서만 수행
* v2 안정화 후 `main <- v2` 병합 후 `v2.0.0` 태그 생성

---

## 1.2 배포 SoT 고정 (필수)

* 운영/배포 기준은 항상 `main`의 태그 커밋이다
* 태그 없는 커밋은 배포 기준이 될 수 없다
* 릴리즈는 레포 전체 단위로 수행한다
* 부분 디렉토리(server/client/infra) 단위 릴리즈는 기본 전략에 포함하지 않는다

---

## 1.3 v1 핫픽스 전파 규칙 (필수)

1. v1 핫픽스는 반드시 `v1` 브랜치에서 작업한다
2. 릴리즈 시 `v1.x.y` 태그 생성
3. 동일 수정이 v2에도 필요할 경우:

   * `merge`가 아닌 **`cherry-pick`으로 v2에 이식**
   * v1 브랜치를 v2에 직접 병합하지 않는다

이 규칙은 브랜치 히스토리 오염을 방지하기 위함이다.

---

# 2. 커밋 전략

## 2.1 문서 우선 원칙 (강제)

* 새 기능/변경 사항은 구현 전에 관련 문서를 먼저 커밋한다
* 정책/흐름/의사결정 변경은 ADR 작성 후 코드 변경 가능
* 문서와 코드가 불일치할 경우 문서를 기준으로 수정한다

---

## 2.2 커밋 메시지 표준 (prefix + scope + 한글 고정)

형식:

```
type(scope): 변경 요약을 한글로 작성
```

### 허용 type

* `docs`
* `feat`
* `fix`
* `test`
* `chore`
* `refactor`

### 허용 scope (모노레포 기준)

* `server`
* `client`
* `infra`
* `docs`
* `ops`
* `build`
* `test`

### 본문(body) 작성 기준

* **단순 변경**(1~3개 파일, 단일 목적): 제목 한 줄로 충분하다
* **대량/복합 변경** 시: 본문에 다음을 명시한다
  * 변경 요약(무엇을, 왜)
  * 영향 범위(어떤 모듈/문서)
  * 관련 SoT 문서 링크(해당 시)

---

## 2.3 커밋 메시지 언어 정책 (필수)

* 커밋 제목(subject)은 **반드시 한글로 작성한다**
* 커밋 본문(body) 또한 한글로 작성한다
* 영어 기술 용어(API, DTO, Kafka 등)는 필요 시 사용 가능하나 설명은 한글로 작성한다
* 불필요한 이모지/마케팅 문구/감정 표현은 금지한다

---

## 2.4 커밋 예시

단순 변경(한 줄):

```
feat(server): 주문 시도 멱등 제약 조건 추가

fix(client): 웹소켓 중복 구독 방지 로직 수정

chore(infra): nginx 리버스 프록시 설정 정리
```

대량 변경(본문 포함):

```
docs(docs): 문서 SoT 갱신 및 AGENTS.md 추가

- 요약: v2 문서 구조 정리, Cursor 에이전트 규칙(AGENTS.md) 추가
- 영향: docs/ 전반, 아키텍처/운영/통합 문서 신규·수정
- 관련: docs/README.md, docs/architecture/*, docs/operations/*
```

---

## 2.5 커밋 단위 규칙

* 문서 변경은 코드 변경과 가능하면 분리한다
* 기능 + 리팩토링 + 포맷 변경을 한 커밋에 섞지 않는다
* 대량 자동 포맷/전체 파일 교체 커밋은 금지
* 자산 교체는 `chore(client): ...` 형태로 명확히 구분한다

---

## 2.6 Git 훅 설정 (필수)

문서만으로는 도구가 규칙을 우회할 수 있으므로, **로컬 Git 훅으로 prefix 검증을 강제**한다.

* 훅 위치: `.githooks/commit-msg` (레포에 버전 관리)
* 설정(클론/초기화 시 **한 번만** 실행):

  ```bash
  git config core.hooksPath .githooks
  ```

* 효과: `client:`, `style:` 등 비표준 prefix 커밋은 로컬에서 즉시 실패한다.
* 허용되지 않은 커밋 시 예시 출력:

  ```
  Invalid commit message (ADR-0001).
  Use: <type>(optional-scope): <subject>
  Allowed types: docs, feat, fix, test, chore, refactor
  Allowed scopes: server, client, infra, docs, ops, build, test
  Example: chore(client): 로고 에셋 교체
  ```

---

# 3. 태그 전략

## 3.1 버전 정책

* v1: `v1.x.y`
* v2: `v2.x.y`
* 태그는 반드시 `main`에서 생성한다

---

## 3.2 릴리즈 조건

릴리즈 태그는 아래 조건을 만족해야 한다:

* 문서 SoT와 코드가 일치
* 주요 테스트 통과
* 운영/보안 정책 위반 없음

---

# Consequences

* 운영 기준(main)과 개발 기준(v2)이 명확히 분리된다
* v1 핫픽스가 v2에 안전하게 전파 가능하다
* 모노레포 환경에서도 변경 범위 추적이 용이하다
* 커밋 로그 가독성과 검색성이 향상된다
* 프로젝트 전반에서 일관된 언어 정책이 유지된다

---

# Alternatives

* v2를 새 레포로 분리 (이력 분산/운영 복잡도 증가)
* main 단일 브랜치 + 태그만 운영 (핫픽스 흐름 불명확)
* release 브랜치 전략 도입 (개인 프로젝트에는 과도한 복잡성)