# ADR-0005: Upbit API 키 암호화 저장(AES-GCM) 및 키관리

- Status: **Accepted**
- Date: 2026-02-14

## Context
Upbit API 키는 유출 시 즉시 실거래 피해로 이어질 수 있는 최상위 민감정보이다.  
서버가 자동매매를 수행하려면 키를 저장해야 하며, 저장 시 평문 보관은 금지해야 한다.

## Decision
- Upbit Access/Secret Key는 DB에 **암호문으로만** 저장한다.
- 암호화는 **AES-256-GCM**(인증 암호화)을 사용한다.
- 암호화 마스터키(`MASTER_KEY`)는:
  - 로컬: `.env.local`에서 주입(커밋 금지)
  - 운영: VM 환경변수에서 주입(파일 저장 지양)
- 키 로테이션을 위해 `key_version`을 유지한다.

## Consequences
- 키 유출 위험이 현저히 감소한다(단, 마스터키 유출 시 동일하게 위험).
- 키 로테이션 절차/도구가 필요하다.
- 구현 복잡도가 약간 증가하지만, v2 MVP에 포함할 가치가 있다.

## Alternatives Considered
1) 키 저장 금지(사용 시마다 입력)  
- 단점: 자동매매 상시 실행과 충돌, 운영 불가능에 가까움

2) 단순 Base64/마스킹 저장  
- 단점: 암호화가 아니며 보안 요구사항을 만족하지 못함
